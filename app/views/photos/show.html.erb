<h1>
  <%= @photo.title %>
</h1>


<div class="row clearfix">
  <div class="span8">


<p id="photo">
  <%= image_tag @photo.image %>
</p>

<p id="photoId" class="hidden">
  <%= @photo.id %>
</p>

 <section id="songs">

      <% @options.each_with_index do |option, index| %>
        <h2 class="hidden">Listen to...<%= option.song_title %></h2>
      <div class="hidden flex-video" id="<%= index %>"> 
                <%= raw option.embed_code %>
      </div>
      <% end %>
    </section>


    <section id="song" class="hidden">
      <h2><%= @photo.song_title %></h2> 
        <div class="flex-video widescreen">
                <%= raw @photo.embed_code %>
        </div>   
    </section>

<% if can? :edit, @article %>
<%= link_to 'Edit', edit_photo_path(@photo) %> |
<%= link_to 'Back', photos_path %>
<% end %>

  </div>

  <div class="span4">
      <p class="well">
        <%= @photo.description %>
      </p>

    <label class="label label-info"><%= pluralize(@photo.guesses.count, 'guess') %></label>
    <label class="label label-success"><%= pluralize(@photo.guesses.where(:correct => true).count, 'correct guess') %></label>
    <label class="label label-warning"><%= pluralize(@photo.guesses.where(:correct =>  false).count, 'incorrect guess') %></label>
    
    <hr/>

    <section id="options" >
      <h3>What do you think they're listening to?</h3>
      <ul class="">
        <% @options.each_with_index do |option, index| %>
          <li class="clearfix">
            <%= link_to (image_tag option.thumbnail), "##{index}",  :class => "song-link"  %>
            <%= link_to "#{option.song_title} <br/> by #{option.song_artist}".html_safe, "##{index}", :class => "song-link" %>
            <a href="#" class="guess btn pull-right" id="">
              Guesss <span class="hidden"><%= option.id %></span>
            </a>
          </li>
        <% end %>
      </ul>
    </section>

  </div>
</div>

<style type="text/css">

#options ul {
  margin-left: 0px;
}

#options ul li a {
  float:left;
  display:inline;
  margin-right: 5px;
  margin-bottom: 5px;
}
  
#options ul li img {
  width:110px;
  /*max-height:50px;*/
}

.flex-video {
  position: relative;
  padding-top: 25px;
  padding-bottom: 67.5%;
  height: 0;
  margin-bottom: 16px;
  overflow: hidden;
}
 
.flex-video.widescreen { padding-bottom: 57.25%; }
.flex-video.vimeo { padding-top: 0; }
 
.flex-video iframe,
.flex-video object,
.flex-video embed {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
}
@media only screen and (max-device-width: 800px), only screen and (device-width: 1024px) and (device-height: 600px), only screen and (width: 1280px) and (orientation: landscape), only screen and (device-width: 800px), only screen and (max-width: 767px) {
  .flex-video { padding-top: 0; }
}


</style>


<script type="text/javascript">

$('.song-link').on('click', function() {
  
  song = $(this).attr('href');
  console.log('clicked' + song);
  $('section#songs div').addClass('hidden');
  $('section#songs h2').addClass('hidden');
  $('section#songs div'+song).removeClass('hidden');
  $('section#songs div'+song).prev('h2').removeClass('hidden');
});

$('.guess').on('click', function(){

  $('#song, #songs').removeClass('hidden');
  $('#options').addClass('hidden');
  $('section#songs div').addClass('hidden');


  var correct = true;
  photoId = $("#photoId").text();
  guessId = $(this).children().text();

  if (parseInt(photoId) == parseInt(guessId)) {
    correct = true;
  } else {
    correct = false;
  }
  console.log("photo: "+photoId);
  console.log("guess: "+guessId);
  console.log("correct: "+correct);

  $.ajax({
    url: "/guesses",
    type: "POST",
    data: {guess: {
             photo_id: photoId, 
             guess_id: guessId,
             correct: correct}},
    success: function(resp){

    if (correct) {
      alert("Welldone! Thanks for guessing") }
    else {
      alert("Unlucky! Try another photo")}
     }
});

})

</script>